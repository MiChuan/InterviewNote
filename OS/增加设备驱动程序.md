# 增加设备驱动程序  

## 目录

[toc]

## 目的

1. 采用模块方法，添加一个新的字符设备驱动程序，实现打开/关闭、读/写等基本操作
2. 编写一个应用程序，测试添加的驱动程序

## 开发环境

- 操作系统: ubuntu 16.04LTS 64位
- 内核版本:linux-4.14.141
- 内存:8G
- 处理器: IntelR CoreTM i5-6200U CPU@ 2.30GHz×4
- 编辑器: Vim
- 编译器: gcc version 5.4.0 20160609

## 实验步骤

1. 编写**设备驱动程序源文件**`mydev.c`
2. 编写`Makefile`文件，用于执行**编译任务**
3. 将设备驱动程序源文件和Makefile文件拷贝到`/usr/src/linux-4.14.141/drivers/misc/mydev`目录下，在该目录打开终端
4. 执行`make`命令,利用Makefile文件进行设备驱动模块**编译**，编译成功后生成`mydev.ko`文件
5. 执行`insmod mydev.ko`，加载设备驱动模块
6. 通过`lsmod`命令查看模块是否加载成功，通过`cat /proc/devices`命令查看**新增设备名**mydev和**主设备号**241
7. 进入`/dev`目录，执行命令`mknod /dev/mydev c 241 0`，生成设备文件，其中，mydev为**设备文件名**，241为**主设备号**，0为**从设备号**，c表示**字符设备**，执行成功后在/dev目录中会生成一个**新设备文件**
8. 编译**测试程序**，执行并进行测试